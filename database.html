

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Database筆記 (MySQL, PostgreSQL, SQLite, MongoDB) &mdash; CompDocs 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="CompDocs 1.0 documentation" href="index.html"/>
        <link rel="next" title="Design" href="design.html"/>
        <link rel="prev" title="Web DevOops" href="web_devoops.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> CompDocs
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="programming.html">Programming 程式開發</a><ul>
<li class="toctree-l2"><a class="reference internal" href="programming.html#guideline">Guideline</a></li>
<li class="toctree-l2"><a class="reference internal" href="programming.html#changelog-readme">Changelog &amp; README</a></li>
<li class="toctree-l2"><a class="reference internal" href="programming.html#languages">Languages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="web_develop.html">Web Develop</a><ul>
<li class="toctree-l2"><a class="reference internal" href="web_develop.html#nodejs-npm">NodeJS / NPM</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_develop.html#gulp">gulp</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_develop.html#production">Production</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_develop.html#design">Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="web_develop.html#typography">Typography</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="web_develop.html#id1">工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_develop.html#id2">資源</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_develop.html#performance">Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_develop.html#cache">Cache</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="web_devoops.html">Web DevOops</a><ul>
<li class="toctree-l2"><a class="reference internal" href="web_devoops.html#web-server-daemon">Web server / Daemon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="web_devoops.html#service">service</a></li>
<li class="toctree-l3"><a class="reference internal" href="web_devoops.html#supervisor">supervisor</a></li>
<li class="toctree-l3"><a class="reference internal" href="web_devoops.html#gunicorn">gunicorn</a></li>
<li class="toctree-l3"><a class="reference internal" href="web_devoops.html#uwsgi">uwsgi</a></li>
<li class="toctree-l3"><a class="reference internal" href="web_devoops.html#nginx">nginx</a></li>
<li class="toctree-l3"><a class="reference internal" href="web_devoops.html#apache">Apache</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="web_devoops.html#php-environment">PHP environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_devoops.html#python-environment">python environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="web_devoops.html#pillow-jpeg">Pillow jpeg 老問題</a></li>
<li class="toctree-l3"><a class="reference internal" href="web_devoops.html#cryptography">cryptography 安裝失敗</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Database筆記 (MySQL, PostgreSQL, SQLite, MongoDB)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mysql">MySQL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cookbook">cookbook</a></li>
<li class="toctree-l3"><a class="reference internal" href="#function">function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#schema">Schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">最佳化</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tools">Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">常用處理</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">資料庫編碼</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command">command</a></li>
<li class="toctree-l3"><a class="reference internal" href="#server-management">Server Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#q-a">Q &amp; A</a></li>
<li class="toctree-l3"><a class="reference internal" href="#others">others</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#postgresql">PostgreSQL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install">Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">command</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sql-syntax">常用 SQL Syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sqlite">Sqlite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#snippets">snippets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id5">比較</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mongodb">MongoDB</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Design</a></li>
</ul>
<p class="caption"><span class="caption-text">Programming Language</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="javascript.html">JavaScript</a><ul>
<li class="toctree-l2"><a class="reference internal" href="javascript.html#tutorial">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript.html#id1">特色</a><ul>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#the-good-part">The Good part</a></li>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#id2">不良</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="javascript.html#snippets">Snippets</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript.html#dom">DOM 操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript.html#library-framework">Library / Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#jquery">jQuery</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="javascript.html#debug-tools-console">Debug Tools (console)</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript.html#tips">Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript.html#adv">Adv.</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript.html#compare-jquery-vanilla-javascript">compare jQuery &amp; vanilla JavaScript</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="html.html">HTML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="html.html#html5">HTML5</a></li>
<li class="toctree-l2"><a class="reference internal" href="html.html#header">Header</a></li>
<li class="toctree-l2"><a class="reference internal" href="html.html#performance">Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="html.html#tools">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="html.html#spectial-character">spectial character</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="css.html">CSS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="css.html#tutorial">Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="css.html#basic">Basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="css.html#position">定位 (position)</a></li>
<li class="toctree-l3"><a class="reference internal" href="css.html#box">Box</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="css.html#selector">Selector</a></li>
<li class="toctree-l2"><a class="reference internal" href="css.html#methods">Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="css.html#debug">Debug</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="css.html#snippets">Snippets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="css.html#id1">應用</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="css.html#gallery">Gallery</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="lua.html">Lua</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python.html#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#function-arguments">Function Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python.html#regular-expression">regular expression</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#list-compension">list compension</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#string">string</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#time">日期/時間 time</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#file">file</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#json">json</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#id5">算數</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#io-shell-commond-line">IO / shell / commond line</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#coding">coding</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#shell">shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#simple-http-server">simple http server</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#try-except">try/except</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python.html#profiling">Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#modules">Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python.html#mysqldb">MySQLdb</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#image-pil-pillow">Image, PIL, Pillow</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#excel">Excel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python.html#tutorial">Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python.html#overview">overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#id6">引數</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#build-in-functions">build-in functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python.html#tips">Tips</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python.html#syntax">syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#id7">coding</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#array">array排序</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html#list">list 找出最常出現</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python.html#coding-style">Coding Style</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python.html#id8">整理</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python.html#reference">reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#package">Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#advance">Advance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python.html#decorator">decorator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python.html#pandas">Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html#tricks">Tricks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scripts_matrix.html">比較</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scripts_matrix.html#id2">字串</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python_frameworks.html">Python Web Frameworks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python_frameworks.html#flask">Flask</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python_frameworks.html#api">API</a></li>
<li class="toctree-l3"><a class="reference internal" href="python_frameworks.html#best-practice">Best Practice</a></li>
<li class="toctree-l3"><a class="reference internal" href="python_frameworks.html#extensions-plugins">Extensions (Plugins)</a></li>
<li class="toctree-l3"><a class="reference internal" href="python_frameworks.html#snippets">snippets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python_frameworks.html#jinja2">Jinja2</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_frameworks.html#sqlalchemy">SQLAlchemy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python_frameworks.html#id1">Snippets</a></li>
<li class="toctree-l3"><a class="reference internal" href="python_frameworks.html#error">常見error</a></li>
<li class="toctree-l3"><a class="reference internal" href="python_frameworks.html#ref">ref</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python_frameworks.html#django">Django</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="soft/emacs.html">Emacs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="soft/emacs.html#id1">常用</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/emacs.html#id2">基本操作</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#id3">檔案</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#movement">移動 Movement</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#editing">編輯 Editing</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#register-and-bookmark">Register and Bookmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#coding">Coding</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#macro">Macro</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#regular-expression">Regular Expression</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#help">Help</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#shell">shell</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/emacs.html#configure">configure</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/emacs.html#spacemacs">Spacemacs</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/emacs.html#modes">Modes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#dired">Dired</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#id4">批次改檔名</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#org-mode">Org-mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#calc">Calc</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#magit">Magit</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#html">HTML</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#graphviz-dot">Graphviz (dot)</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#others-mode">Others Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/emacs.html#id5">其他 modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/emacs.html#deft">deft</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/emacs.html#elist">elist 套件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#elscreen">elscreen</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/emacs.html#skeleton">skeleton</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/emacs.html#ref">ref</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="soft/git.html">GIT</a><ul>
<li class="toctree-l2"><a class="reference internal" href="soft/git.html#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#init">init</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/git.html#basic">Basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/git.html#git-command">git command</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#git-clone-add">git clone / add</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#git-reset-revert">git reset / revert</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#git-log">git log</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#git-commit-checkout-stash">git commit / checkout / stash</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#git-branch-merge">git branch / merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#git-tag">git tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#other">other</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#undo">undo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/git.html#tips">Tips</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#commit">減少 commit</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/git.html#git-clonebranch">git clone某一個branch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/git.html#id1">other</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/git.html#setting">setting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_line.html">Command 常用指令</a><ul>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#package">package</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#system-disk">system disk</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#snippets">snippets</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#id1">檔案</a><ul>
<li class="toctree-l3"><a class="reference internal" href="command_line.html#compress-depress">壓縮/解壓縮 compress/depress</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#id2">網路</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#ssh">SSH</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#service">Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="command_line.html#crontab">Crontab</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#locale">locale</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#vim">VIM</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#pandoc">pandoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#dot-grphviz">dot (grphviz)</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line.html#ffmpeg-avconv">ffmpeg / avconv</a><ul>
<li class="toctree-l3"><a class="reference internal" href="command_line.html#id3">Snippets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="os_desktop.html">OS &amp; Desktop</a><ul>
<li class="toctree-l2"><a class="reference internal" href="os_desktop.html#linux">Linux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#cub">Cub</a></li>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#debian-lxde">Debian - LXDE</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="os_desktop.html#mac-osx">Mac OSX</a></li>
<li class="toctree-l2"><a class="reference internal" href="os_desktop.html#browser">Browser</a><ul>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#my-bookmarklet">my bookmarklet</a></li>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#browser-plugin-extensions">Browser plugin/extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#firefox">Firefox</a></li>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#opera">Opera</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="os_desktop.html#id1">好用軟體</a><ul>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#id2">開發工具</a></li>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#id3">應用</a></li>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#id4">系統工具</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="os_desktop.html#leopardmavericks-archive">從Leopard升級到Mavericks (Archive)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#mavericks">1. 下載Mavericks</a></li>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#id5">2. 製作開機磁碟</a></li>
<li class="toctree-l3"><a class="reference internal" href="os_desktop.html#id6">3. 安裝</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="soft/sphinx.html">Sphinx - reST (reStructuredText)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="soft/sphinx.html#id1">使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/sphinx.html#id2">語法</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/sphinx.html#id3">文件結構</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/sphinx.html#id4">參考資料</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/sphinx.html#themes">Themes</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/sphinx.html#publish">Publish</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aws_eb_flask.html">Deploying Flask (Python) to AWS Elastic Beanstalk</a><ul>
<li class="toctree-l2"><a class="reference internal" href="aws_eb_flask.html#quickstart">quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_eb_flask.html#ec2">EC2 環境</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_eb_flask.html#id1">設定</a><ul>
<li class="toctree-l3"><a class="reference internal" href="aws_eb_flask.html#id2">環境</a></li>
<li class="toctree-l3"><a class="reference internal" href="aws_eb_flask.html#custom-domain">custom domain</a></li>
<li class="toctree-l3"><a class="reference internal" href="aws_eb_flask.html#https">HTTPS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="aws_eb_flask.html#command">command</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_eb_flask.html#problems">問題 / Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_eb_flask.html#quickstart-old">quickstart (old)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="aws_eb_flask.html#eb-commend-tools">1. 安裝eb commend tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="aws_eb_flask.html#id5">2. 準備部署</a></li>
<li class="toctree-l3"><a class="reference internal" href="aws_eb_flask.html#id6">3. 跑起來</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="aws_eb_flask.html#id7">參考</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="soft/vagrant_and_docker.html">Vagrant, Docker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="soft/vagrant_and_docker.html#vagrant">Vagrant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/vagrant_and_docker.html#quickstart">QuickStart</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/vagrant_and_docker.html#docker">Docker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="soft/pelican.html">Pelican</a><ul>
<li class="toctree-l2"><a class="reference internal" href="soft/pelican.html#quick-start">Quick-start</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/pelican.html#rest-markdown">文章格式 (reST, markdown)</a></li>
<li class="toctree-l2"><a class="reference internal" href="soft/pelican.html#git-hub">git hub</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/pelican.html#id1">環境設定</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/pelican.html#html">產生HTML，發佈</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/pelican.html#domain">自訂domain</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/pelican.html#rest-restructuredtext-markdown">用reST (reStructuredText) 還是markdown好?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/pelican.html#id2">補充</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/pelican.html#id3">參考</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/pelican.html#blog-generator">靜態blog generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/pelican.html#deploy-to-github">deploy to github</a></li>
<li class="toctree-l3"><a class="reference internal" href="soft/pelican.html#syntax">syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="soft/pelican.html#id4">補充</a><ul>
<li class="toctree-l3"><a class="reference internal" href="soft/pelican.html#v-3-4">更新 v 3.4</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="soft/tmux.html">tmux</a></li>
<li class="toctree-l1"><a class="reference internal" href="qna.html">問題解決</a><ul>
<li class="toctree-l2"><a class="reference internal" href="qna.html#web-server">Web Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="qna.html#aws">AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="qna.html#bitbucket-multiple-ssh-keys">bitbucket multiple ssh keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="qna.html#push-notification">push notification</a></li>
<li class="toctree-l2"><a class="reference internal" href="qna.html#python-package-pip">Python package (pip)</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">CompDocs</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Database筆記 (MySQL, PostgreSQL, SQLite, MongoDB)</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/database.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="database-mysql-postgresql-sqlite-mongodb">
<h1>Database筆記 (MySQL, PostgreSQL, SQLite, MongoDB)<a class="headerlink" href="#database-mysql-postgresql-sqlite-mongodb" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mysql">
<h2>MySQL<a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h2>
<p>Syntax</p>
<div class="highlight-sql"><div class="highlight"><pre>[ALL | DISTINCT | DISTINCTROW ]
  [HIGH_PRIORITY]
  [STRAIGHT_JOIN]
  [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]
  [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]
select_expr [, select_expr ...]
[FROM table_references
[WHERE where_condition]
[GROUP BY {col_name | expr | position}
  [ASC | DESC], ... [WITH ROLLUP]]
[HAVING where_condition]
[ORDER BY {col_name | expr | position}
  [ASC | DESC], ...]
[LIMIT {[offset,] row_count | row_count OFFSET offset}]
[PROCEDURE procedure_name(argument_list)]
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MySQL的JOIN預設是 <code class="docutils literal"><span class="pre">INNER</span> <span class="pre">JOIN</span></code> ，另一種是LEFT OUTER JOIN，通常用 <code class="docutils literal"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code> 就可以了。MySQL會優先處理JOIN，然後才是WHERE。</p>
</div>
<div class="section" id="cookbook">
<h3>cookbook<a class="headerlink" href="#cookbook" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">mydb</span>
  <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8</span>
  <span class="k">DEFAULT</span> <span class="k">COLLATE</span> <span class="n">utf8_general_ci</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="o">`</span><span class="k">user</span><span class="o">`</span>
<span class="k">ADD</span> <span class="o">`</span><span class="n">intro</span><span class="o">`</span> <span class="nb">text</span> <span class="k">COLLATE</span> <span class="s1">&#39;utf8_general_ci&#39;</span> <span class="k">NULL</span> <span class="k">AFTER</span> <span class="o">`</span><span class="n">status</span><span class="o">`</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">run_log</span><span class="o">`</span>
<span class="k">ADD</span> <span class="o">`</span><span class="n">step</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NULL</span><span class="p">;</span>
</pre></div>
</div>
<p>CRUD:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tbl_name</span> <span class="p">(</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">)</span> <span class="k">VALUES</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="n">col1</span><span class="o">*</span><span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">tbl_name</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="k">c</span><span class="p">)</span> <span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="k">user</span> <span class="k">SET</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">(</span><span class="s1">&#39;新密碼&#39;</span><span class="p">)</span> <span class="k">where</span> <span class="k">user</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">user</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="n">xx</span><span class="p">;</span>
</pre></div>
</div>
<p>以中文筆畫排序:</p>
<div class="highlight-sql"><div class="highlight"><pre>CONVERT( 欄位名稱 using big5) 。
</pre></div>
</div>
<p>LIMIT</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">foo</span> <span class="k">LIMIT</span> <span class="mi">20</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">foo</span> <span class="k">LIMIT</span> <span class="mi">20</span> <span class="k">OFFSET</span> <span class="mi">40</span> <span class="c1">-- 從40個以後抓20個</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">foo</span> <span class="k">LIMIT</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">20</span> <span class="c1">-- 同上</span>
</pre></div>
</div>
<p>查看database容量:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">table_schema</span> <span class="ss">&quot;database_name&quot;</span><span class="p">,</span>
<span class="k">sum</span><span class="p">(</span> <span class="n">data_length</span> <span class="o">+</span> <span class="n">index_length</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span>
<span class="mi">1024</span> <span class="ss">&quot;Data Base Size in MB&quot;</span><span class="p">,</span>
<span class="k">sum</span><span class="p">(</span> <span class="n">data_free</span> <span class="p">)</span><span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span> <span class="ss">&quot;Free Space in MB&quot;</span>
<span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">TABLES</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">table_schema</span> <span class="p">;</span>
</pre></div>
</div>
<p>SELECT and UPDATE:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="n">table_A</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">table_B</span> <span class="k">ON</span> <span class="n">table_B</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">table_A</span><span class="p">.</span><span class="n">bid</span>
<span class="k">SET</span> <span class="n">table_A</span><span class="p">.</span><span class="n">some_column</span> <span class="o">=</span> <span class="s1">&#39;some_value&#39;</span> <span class="k">WHERE</span> <span class="n">some_condition</span><span class="p">;</span>
</pre></div>
</div>
<p>增加欄位 add column:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">contacts</span> <span class="k">ADD</span> <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">contacts</span> <span class="k">ADD</span> <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> <span class="k">AFTER</span> <span class="n">name</span><span class="p">;</span>
</pre></div>
</div>
<p>每個月統計</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="k">YEAR</span><span class="p">(</span><span class="n">dtime</span><span class="p">),</span> <span class="k">MONTH</span><span class="p">(</span><span class="n">dtime</span><span class="p">),</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">api2_log</span>
<span class="k">WHERE</span> <span class="n">cls</span> <span class="o">=</span> <span class="s1">&#39;talkingapp&#39;</span> <span class="k">AND</span> <span class="n">act</span> <span class="o">=</span> <span class="s1">&#39;update_stat&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">YEAR</span><span class="p">(</span><span class="n">dtime</span><span class="p">),</span><span class="k">MONTH</span><span class="p">(</span><span class="n">dtime</span><span class="p">)</span>
</pre></div>
</div>
<p>status:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SHOW</span> <span class="k">TABLE</span> <span class="n">STATUS</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mysqlshow -uroot -p123456 --status db_name
</pre></div>
</div>
<p>統計相關:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="c1">---- 欄位 col1 出現超過 5 次:</span>
<span class="c1">-- WHERE (放在 group 前面) 在這裏不能用, 要改用 having</span>
<span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">cnt</span> <span class="k">from</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="o">&lt;</span><span class="n">col1</span><span class="o">&gt;</span> <span class="k">HAVING</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cnt</span> <span class="k">DESC</span><span class="p">;</span>

<span class="c1">-- 欄位 col1 不重複, 符合條件, 總共筆數</span>
<span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="o">&lt;</span><span class="n">col1</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">FROM</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span> <span class="k">WHERE</span> <span class="o">&lt;</span><span class="n">col2</span><span class="o">&gt;</span> <span class="p">...</span>
</pre></div>
</div>
</div>
<div class="section" id="function">
<h3>function<a class="headerlink" href="#function" title="Permalink to this headline">¶</a></h3>
<p>時間</p>
<div class="highlight-sql"><div class="highlight"><pre>SELECT NOW(),CURDATE(),CURTIME() ; | 2012-06-04 14:19:42 | 2012-06-04 | 14:19:42 |
SELECT MONTH(FROM_UNIXTIME(add_date)) as month
SELECT NOW(), NOW() - INTERVAL 1 DAY ;今天跟昨天
</pre></div>
</div>
<p>ref: <a class="reference external" href="http://dev.mysql.com/doc/refman/5.5/en/date-and-time-functions.html">http://dev.mysql.com/doc/refman/5.5/en/date-and-time-functions.html</a></p>
</div>
<div class="section" id="schema">
<h3>Schema<a class="headerlink" href="#schema" title="Permalink to this headline">¶</a></h3>
<p>原則</p>
<ul class="simple">
<li>小的好</li>
<li>簡單的好, 如integers比characters好, 不用判斷collations</li>
<li>不要用 <strong>NULL</strong>, 影響效能, 可以用 <code class="docutils literal"><span class="pre">0</span></code>, <code class="docutils literal"><span class="pre">空字串</span></code>或 <code class="docutils literal"><span class="pre">N</span></code>等值來代替</li>
</ul>
<p>整數</p>
<p>資料儲存上 <code class="docutils literal"><span class="pre">TINYINT</span></code>, <code class="docutils literal"><span class="pre">SMALLINT</span></code>, <code class="docutils literal"><span class="pre">MEDIUMINT</span></code>, <code class="docutils literal"><span class="pre">INT</span></code>, <code class="docutils literal"><span class="pre">BIGINT</span></code>各使用了8, 16, 26, 32, 64 bits, 數值範圍-2^(N-1)到2(N-1)-1, 加了 <code class="docutils literal"><span class="pre">UNSIGNED</span></code>後, 範圍從0到2^N-1. 但是MySQL在 <strong>計算</strong>上是用64-bit的BIGINT來算, 就算是32-bit的系統</p>
<p>MySQL使用的整數長度, 如INT(11), 並不會真的有儲存限制, 只是為了command-line client的顯示, 在儲存和計算上INT(1)和INT(20)是一樣的.</p>
<p>實數</p>
<p>浮點數可以用 <code class="docutils literal"><span class="pre">FLOAT</span></code> (4 bytes), <code class="docutils literal"><span class="pre">DOUBLE</span></code> (8 bytes), <code class="docutils literal"><span class="pre">DECIMAL</span></code> 等格式, MySQL在浮點數的計算上都是用DOUBLE, 資料儲存上以DECIMAL為佳</p>
<p>VARCHAR和CHAR</p>
<p><code class="docutils literal"><span class="pre">VARCHAR</span></code>是可變長度, 會用1到2byte存字串長度(MyISAM或InnoDB), <code class="docutils literal"><span class="pre">CHAR</span></code>是固字長度, 用來存Y/N, MD5值等.</p>
<p>時間</p>
<p><code class="docutils literal"><span class="pre">DATETIME</span></code> 以YYYYMMDDHHMMSS的格式儲存, 範圍從1001到9999年, 8 bytes</p>
<p><code class="docutils literal"><span class="pre">TIMESTAMP</span></code> 以Unix timestamp格式, 範圍從1970到2038 (格林威治標準時間)</p>
<p>選擇用TIMESTAMP比較節省空間, 但不要把unix timestamp存在整數格式, 因為沒有什麼好處, 也很難判讀</p>
<p>其他</p>
<p><code class="docutils literal"><span class="pre">BLOB</span></code>和 <code class="docutils literal"><span class="pre">TEXT</span></code>不同的是TEXT會有character set和collation, BLOB沒有</p>
</div>
<div class="section" id="id1">
<h3>最佳化<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>所有資料表最佳化</p>
<div class="highlight-sql"><div class="highlight"><pre>$ mysqlcheck -a -c -o -r --all-databases -uroot -p

$ mysqlcheck --all-databases
$ mysqlcheck --all-databases -o
$ mysqlcheck --all-databases --auto-repair
$ mysqlcheck --all-databases --analyze
</pre></div>
</div>
<p>a: analyze, c: check, o: optimize, r: repair</p>
<p>重建索引:</p>
<div class="highlight-python"><div class="highlight"><pre>myisamchk -s /var/lib/mysql/*/*.MYI
</pre></div>
</div>
<p>s: silent mode (output only errors)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">mysql要先停</p>
</div>
</div>
<div class="section" id="tools">
<h3>Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://hackmysql.com/mysqlreportdoc">mysqlreport Documentation</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>mysqlreport  --user MY_USER --password MY_PASS
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Read Hit: 從硬碟/記憶體讀取key的比率, 最好不要低於99%, 太低的話, 檢查Key Report, 調高key buffer</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Slow: 要低於0.05</p>
</div>
<p><a class="reference external" href="http://hackmysql.com/mysqlreportguide">The Guide To Understanding mysqlreport</a></p>
<ul class="simple">
<li><a class="reference external" href="http://www.day32.com/MySQL/">Sundry MySQL Scripts and Docs</a> 很棒的MySQL tuning scripts</li>
<li><a class="reference external" href="https://github.com/rackerhacker/MySQLTuner-perl">rackerhacker/MySQLTuner-perl</a></li>
<li><a class="reference external" href="http://hackmysql.com/mysqlsla">mysqlsla :: Parse, filter and sort MySQL slow, general and binary logs</a></li>
</ul>
</div>
<div class="section" id="id2">
<h3>常用處理<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>第一次設定:</p>
<div class="highlight-python"><div class="highlight"><pre>/usr/bin/mysql_secure_installation
</pre></div>
</div>
<p>改root密碼:</p>
<div class="highlight-python"><div class="highlight"><pre>mysqladmin -u root -p&#39;oldpassword&#39; password newpass
</pre></div>
</div>
<p>via: <a class="reference external" href="http://www.cyberciti.biz/faq/mysql-change-root-password/">MySQL Change root Password</a></p>
<p>忘記root密碼:</p>
<p>1.先關掉mysql server:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo /etc/init.d/mysql stop
</pre></div>
</div>
<p>2.開server, 但忽略grant-tables (存密碼的地方):</p>
<div class="highlight-python"><div class="highlight"><pre>mysqld_safe --user=mysql --skip-grant-tables --skip-networking &amp;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">mysqld_safe就是用更安全的方式開啟(重載)mysqld, 如有錯誤發生時會重開, 寫log.</p>
</div>
<p>3.用root進入sql改密碼:</p>
<div class="highlight-python"><div class="highlight"><pre>mysql -u root mysql
&gt; UPDATE user SET Password=PASSWORD(&#39;123456&#39;) WHERE User=&#39;root&#39;;
&gt; FLUSH PRIVILEGES;
&gt; exit
</pre></div>
</div>
<p>或是把上面sql語法存在foo.txt裡, 用:</p>
<div class="highlight-python"><div class="highlight"><pre>mysqld_safe --init-file=/pathto/foo.txt &amp;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">flush privileges; 重載授權表</p>
</div>
<p>參考</p>
<ul class="simple">
<li><a class="reference external" href="http://wiki.joyent.com/display/smart/Resetting+the+MySQL+Root+Password">Resetting the MySQL Root Password - SmartMachines - Joyent Customer Wiki</a></li>
</ul>
<p>連接外部資料庫:</p>
<p>1.改my.cnf(通常在/etc下):</p>
<div class="highlight-python"><div class="highlight"><pre># skip-networking 此行註解掉
bind-address = 11.22.33.44 # 加上要連過來的ip
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">OpenSolaris的my.cnf好像在加在/var/mysql才會有作用</p>
</div>
<p>2.重開mysql</p>
<p>3.連線進入:</p>
<div class="highlight-python"><div class="highlight"><pre>mysql -u root –p mysql
mysql&gt; CREATE DATABASE foo;
mysql&gt; GRANT ALL ON foo.* TO bar@&#39;11.22.33.44&#39; IDENTIFIED BY &#39;密碼&#39;;

mysql&gt; update db set Host=&#39;11.22.33.44&#39; where Db=&#39;資料庫名稱&#39;;
mysql&gt; update user set Host=&#39;11.22.33.44&#39; where user=&#39;使用者名稱&#39;;
</pre></div>
</div>
<p>4.重開mysql</p>
<p>5.測試能不能連:</p>
<div class="highlight-python"><div class="highlight"><pre>mysql -h 主機 -u root -p
</pre></div>
</div>
<p>資料庫 data</p>
<div class="highlight-python"><div class="highlight"><pre>Mac: /usr/local/mysql/data/
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>資料庫編碼<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>列出MySQL各種編碼變數:</p>
<div class="highlight-python"><div class="highlight"><pre>show variables like &quot;character%&quot;;
</pre></div>
</div>
<p>php的 <code class="docutils literal"><span class="pre">mysql_query(&quot;SET</span> <span class="pre">NAMES</span> <span class="pre">UTF8&quot;);</span></code> 相當於MySQL:</p>
<div class="highlight-python"><div class="highlight"><pre>SET character_set_client = utf8;
SET character_set_results = utf8;
SET character_set_connection = utf8;
</pre></div>
</div>
<p>編碼順序: <strong>client -&gt; connect -&gt; server -&gt; connect -&gt; client</strong></p>
<p>亂碼處理:</p>
<p>原本是latin1(ISO 8859-1)編碼, 要改成utf-8:</p>
<ol class="arabic simple">
<li>mysqldump -uroot -p mydb &#8211;default-character-set=latin1 &gt; old.sql</li>
<li>piconv -f utf8 -t utf8 old.sql&gt; new.sql</li>
<li>打開new.sql裡面加 <code class="docutils literal"><span class="pre">SET</span> <span class="pre">NAMES</span> <span class="pre">utf8</span></code>;</li>
<li>mysql -uroot -pmypassword -Dmydb_new &#8211;default-character-set=utf8 &lt; new.sql</li>
</ol>
</div>
<div class="section" id="command">
<h3>command<a class="headerlink" href="#command" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sql"><div class="highlight"><pre>mysql -uUSER -pPASS -e &quot;DROP DATABASE foo; CREATE DATABASE bar COLLATE &#39;utf8_general_ci&#39;;&quot;

SHOW DATABASES;
SHOW TABLES;
USE db_name;

TRUNCATE tbl_name;
DROP DATABASE db_name;
DROP TABLE tbl_name;

SHOW TABLE STATUS; # 看collation
DESCRIBE tbl_name; # 看table屬性
SHOW FULL COLUMNS FROM tbl_name; #table 細節
ALTER TABLE tablename CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci; # 改欄位編碼

SHOW GLOBAL VARIABLES;
</pre></div>
</div>
</div>
<div class="section" id="server-management">
<h3>Server Management<a class="headerlink" href="#server-management" title="Permalink to this headline">¶</a></h3>
<p>安裝, 以Debian為例:</p>
<div class="highlight-python"><div class="highlight"><pre># 清除
sudo apt-get --purge remove mysql-server mysql-common mysql-client
# 安裝
sudo apt-get install mysql-server mysql-common mysql-client php5-mysql
# 第一次設定admin密碼
mysqladmin -u root password your-new-password
# 啟動
sudo /etc/init.d/mysql restart
# data位置
# /var/lib/mysql
</pre></div>
</div>
<p>Mac OS X:</p>
<p>從 MySql (<a class="reference external" href="http://dev.mysql.com/downloads/mysql/">http://dev.mysql.com/downloads/mysql/</a>) 找適何的package，裝完後:</p>
<p>binary:</p>
<div class="highlight-python"><div class="highlight"><pre>/usr/local/mysql/bin/mysql
</pre></div>
</div>
<p>path:</p>
<div class="highlight-python"><div class="highlight"><pre>export PATH=/usr/local/mysql/bin:$PATH
sudo ln -s /usr/local/mysql/lib/libmysqlclient.18.dylib /usr/lib/libmysqlclient.18.dylib
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">原本沒有 /etc/my.cnf, 可以從 /usr/local/mysql/support-files/ 找一個官方範本來改</p>
</div>
<p><strong>Import / Export</strong></p>
<p>倒整個資料庫:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mysqldump ---u myuser -p myuser_db &gt; myuser_db.sql
$ mysqldump --skip-lock-tables -umysuer -ppassword --database mydb &gt; backup.sql
</pre></div>
</div>
<p>倒一個資料表:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mysqldump -u myuser -p myuser_db sometable &gt; myuser_db_sometable.sql
</pre></div>
</div>
<p>到多個叫foo_開頭的資料表到同一個檔案:</p>
<div class="highlight-python"><div class="highlight"><pre>mysql databasename -u [root] -p[password] -e &#39;show tables like &quot;foo_%&quot;&#39; | grep -v Tables_in | xargs mysqldump [databasename] -u [root] -p[password] &gt; [target_file]
</pre></div>
</div>
<p><strong>import</strong></p>
<p>方法1:</p>
<div class="highlight-python"><div class="highlight"><pre>直接import
$ mysql  -uname -p dbname  --default-character-set=utf8  &lt;  XXX.sql
</pre></div>
</div>
<p>方法2:</p>
<div class="highlight-python"><div class="highlight"><pre>先登入mysql shell介面
$ mysql -u myuser -p
$ use myuser_db; #select db
$ \. myuser_db_sometable.sql
$ \q
</pre></div>
</div>
<p>資料庫轉移, 從 localhost 到另一台DB (直接倒, 不用存 IO):</p>
<div class="highlight-python"><div class="highlight"><pre>$ mysqldump -u db_user -p db_passwd db_name | mysql -u db2_user -p db2_passwd -h db2_host db2_name;
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>my.cnf選用(/usr/share/mysql/下)</p>
<ul class="simple">
<li>my-small.cnf(小於64MB的記憶體)</li>
<li>my-medium.cnf (64~128MB的記憶體)</li>
<li>my-large.cnf (128~512MB的記憶體)</li>
<li>my-huge.cnf (1~2GB的記憶體)</li>
<li>my-innodb-heavy-4G.cnf (4GB的記憶體)</li>
</ul>
<p>找my.cnf:</p>
<div class="highlight-python"><div class="highlight"><pre>mysql --verbose --help | grep -A 1 &#39;Default options&#39;
# CentOS: /etc/my.cnf ~/.my.cnf
</pre></div>
</div>
<p>my.cnf:</p>
<div class="highlight-python"><div class="highlight"><pre>[mysqld]
set-variable=max_connections=250
default-storage-engine=InnoDB # 預設選用InnoDB

# slow query
log-slow-queries=/tmp/slow-query.log #
long_query_time = 3 #query超過2秒時，則會記錄
log-queries-not-using-indexes

# optimize
query_cache_size # 大量相同的query時, 很有用
key_buffer_size # 越大query越快, 但最好設定1/4, 不要超過一半的系統記憶體 (看*.MYI的size多大, 就設多大)
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MySQL安裝時不一定會產生</p>
</div>
<p><strong>調整 memory 用量</strong></p>
<p><a class="reference external" href="https://blog.gslin.org/archives/2016/05/04/6537/調整-mysql-的記憶體用量/">調整 MySQL 的記憶體用量 | Gea-Suan Lin&#8217;s BLOG</a></p>
<p>不要讓 VSZ 超過 90% 的 system memory:</p>
<div class="highlight-python"><div class="highlight"><pre>ps ax -O vsz | grep mysqld # 看 vsz 佔了多少, 然後調整 innodb_buffer_pool_size
</pre></div>
</div>
</div>
<div class="section" id="q-a">
<h3>Q &amp; A<a class="headerlink" href="#q-a" title="Permalink to this headline">¶</a></h3>
<p>error: MySQL server has gone away:</p>
<div class="highlight-python"><div class="highlight"><pre>; my.cnf
max_allowed_packet = 1M ; 超過SQL設定最大長度, 改大一點
; or 連線逾時
wait_timeout
interactive_timeout
</pre></div>
</div>
<p>error: Can&#8217;t connect to local MySQL server through socket &#8216;/var/lib/mysql/mysql.sock&#8217;:</p>
<div class="highlight-python"><div class="highlight"><pre>mysql 資料夾的權限錯誤, (因為把 /var/lib/mysql 搬到其他地方...)

# 處理
$ chown -R mysql:mysql /var/lib/mysql/*
$ chmod -R 700 /var/lib/mysql/*
</pre></div>
</div>
</div>
<div class="section" id="others">
<h3>others<a class="headerlink" href="#others" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://antbsd.twbbs.org/~ant/wordpress/?p=2259">探討 MySQL 授權 | Ant&#8217;s ATField</a></li>
</ul>
</div>
</div>
<div class="section" id="postgresql">
<h2>PostgreSQL<a class="headerlink" href="#postgresql" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install">
<h3>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h3>
<p>mac php (with-postgresql), 為了用 adminer.php:</p>
<ul class="simple">
<li><a class="reference external" href="https://gist.github.com/doole/8651341/59f9ccb85e3ae48861b4f892b342e08efff9236e/">Install PostgreSQL PHP extensions on Mac OS X</a></li>
<li><a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-9-4-on-debian-8">How To Install and Use PostgreSQL 9.4 on Debian 8 | DigitalOcean</a></li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">## package</span>
<span class="c"># debian</span>
<span class="nv">$ </span>apt-get install postgresql postgresql-client postgresql-server-dev-9.4 <span class="c"># or postgresql-server-dev-all</span>

<span class="c"># OSX</span>
<span class="nv">$ </span>brew install postgresql
</pre></div>
</div>
<p>設定新密碼:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo -u postgres psql postgres
<span class="nv">postgres</span><span class="o">=</span><span class="c"># \password postgres</span>
</pre></div>
</div>
<p>以後要用 psql 時 (不用 sudo -u postgres), 要改:</p>
</div>
<div class="section" id="id4">
<h3>command<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># dump</span>
<span class="nv">$ </span>pg_dump -U USERNAME DBNAME &gt; dbexport.pgsql
<span class="nv">$ </span><span class="c"># PGPASSWORD=&quot;mypassword&quot; pg_dump -U myusername dbname 密碼 &gt; output.sql</span>

<span class="c">## import</span>
<span class="nv">$ </span>psql -f backup.sql dbname dbuser

<span class="c">## Debian Jessie</span>
<span class="c"># first time</span>
<span class="c"># createuser myuser</span>

<span class="c">## OSX</span>
<span class="c"># first time</span>
<span class="nv">$ </span>initdb /usr/local/var/postgres -E utf8
<span class="c"># service (daemon)</span>
<span class="nv">$ </span>brew services start postgresql

<span class="c">## export csv</span>
<span class="nv">$ </span>psql -U user -d db_name -c <span class="s2">&quot;Copy (Select * From foo_table LIMIT 10) To STDOUT With CSV HEADER DELIMITER &#39;,&#39;;&quot;</span> &gt; foo_data.csv
</pre></div>
</div>
<p><a class="reference external" href="https://wiki.debian.org/PostgreSql#Installation">PostgreSql - Debian Wiki</a></p>
<p>syntax:</p>
<div class="highlight-python"><div class="highlight"><pre># environment
$sudo -u postgres psql

# ALTER DATABASE name RENAME TO newname

# mysql: SHOW DATABASES
# pgres: \l
# mysql: SHOW TABLES
# pgres: \d
# mysql: USE mydbname
# pgres: \c  mydbname # \connect

# mysql: SHOW COLUMNS
# pgres: \d table

# mysql: DESCRIBE TABLE
# pgres: \d+ table ( \dt)

# exit: \q
</pre></div>
</div>
</div>
<div class="section" id="sql-syntax">
<h3>常用 SQL Syntax<a class="headerlink" href="#sql-syntax" title="Permalink to this headline">¶</a></h3>
<div class="highlight-sql"><div class="highlight"><pre>ALTER USER &quot;user_name&quot; WITH PASSWORD &#39;new_password&#39;;   # 改 user 密碼
ALTER DATABASE name RENAME TO new_name # 不能 connect 時改, 用 psql 不要加 -d
</pre></div>
</div>
</div>
</div>
<div class="section" id="sqlite">
<h2>Sqlite<a class="headerlink" href="#sqlite" title="Permalink to this headline">¶</a></h2>
<p>常用指令</p>
<div class="highlight-python"><div class="highlight"><pre>$ sqlite3 new.db # create db
$ sqlite3 myprecious.db &quot;.dump&quot; ＞ output.sql # dump sql
$ sqlite3 new.db ＜ output.sql # import
# or
$ cat dumpfile.sql | sqlite3 new.db
</pre></div>
</div>
<p>進入sqlite3後:</p>
<div class="highlight-python"><div class="highlight"><pre>.tables  # MySQL的show tables
.schema TABLENAME
.help
.quit
</pre></div>
</div>
<p>ref</p>
<ul class="simple">
<li><a class="reference external" href="http://www.sqlite.org/sqlite.html">Command Line Shell For SQLite</a></li>
</ul>
<div class="section" id="snippets">
<h3>snippets<a class="headerlink" href="#snippets" title="Permalink to this headline">¶</a></h3>
<p>把 count, group by 起來的結果筆數全部加起來, 重點是 &#8220;as A&#8221; 要加</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span> <span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">cnt</span>
<span class="k">FROM</span> <span class="n">taibif_col</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">genus</span><span class="p">)</span> <span class="k">as</span> <span class="n">A</span>
</pre></div>
</div>
<p>單字表沒有照abc排, 要照字母順序排序(num)</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="o">*</span><span class="p">,</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">en_word</span> <span class="k">AS</span> <span class="n">t2</span> <span class="k">where</span> <span class="k">LOWER</span><span class="p">(</span><span class="n">t2</span><span class="p">.</span><span class="n">word</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="k">LOWER</span><span class="p">(</span><span class="n">t1</span><span class="p">.</span><span class="n">word</span><span class="p">))</span> <span class="k">as</span> <span class="n">NUM</span> <span class="k">FROM</span> <span class="n">en_word</span> <span class="k">AS</span> <span class="n">t1</span> <span class="k">WHERE</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">foo</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">LOWER</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</pre></div>
</div>
<p>一個裝置, 安裝了2個app以上的數量統計</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">total</span><span class="p">,</span> <span class="n">num</span> <span class="k">as</span> <span class="n">num_of_apps</span> <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">num</span><span class="p">,</span> <span class="n">did</span> <span class="k">from</span> <span class="n">log_user_data</span> <span class="k">group</span> <span class="k">by</span> <span class="p">(</span><span class="n">did</span><span class="p">)</span> <span class="k">order</span> <span class="k">by</span> <span class="n">num</span> <span class="k">desc</span><span class="p">)</span> <span class="n">t</span> <span class="k">where</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">group</span> <span class="k">by</span> <span class="n">num</span> <span class="k">desc</span>
</pre></div>
</div>
<p>每個字母開頭的單字數量</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">lower</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="n">english</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">as</span> <span class="k">c</span> <span class="k">from</span> <span class="n">words</span> <span class="k">group</span> <span class="k">by</span> <span class="k">c</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h2>比較<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">MySQL:</th><td class="field-body">RAND()</td>
</tr>
<tr class="field-even field"><th class="field-name">Sqlite:</th><td class="field-body">RANDOM()</td>
</tr>
</tbody>
</table>
<p>MySQL有ROW_NUMBER(), Sqlite沒有, 只能用SQL語法的奇技淫巧來達成.</p>
<p>DB 特性討論:</p>
<ul class="simple">
<li><a class="reference external" href="http://developer.olery.com/blog/goodbye-mongodb-hello-postgresql/">Goodbye MongoDB, Hello PostgreSQL</a></li>
</ul>
</div>
<div class="section" id="mongodb">
<h2>MongoDB<a class="headerlink" href="#mongodb" title="Permalink to this headline">¶</a></h2>
<p>debian 版本比較舊, 預設 apt 跑不起來</p>
<p><a class="reference external" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-debian/">Install MongoDB Community Edition on Debian — MongoDB Manual 3.6</a></p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mongod --dbpath db
<span class="nv">$ </span>mongod --dbpath db --smallfiles
</pre></div>
</div>
<p><strong>dump/import</strong></p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mongodump <span class="c"># 預設存成 dump 資料夾</span>
<span class="nv">$ </span>mongorestort <span class="c"># 預設讀取 dump 資料夾</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="design.html" class="btn btn-neutral float-right" title="Design" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="web_devoops.html" class="btn btn-neutral" title="Web DevOops" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Suhen.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>